# ミーンリバージョン戦略ガイド

Hyperliquid HFTボットで使用するミーンリバージョン（平均回帰）戦略の詳細ガイドです。

## 目次

1. [戦略概要](#戦略概要)
2. [なぜミーンリバージョンか](#なぜミーンリバージョンか)
3. [使用するテクニカル指標](#使用するテクニカル指標)
4. [エントリー条件](#エントリー条件)
5. [エグジット条件](#エグジット条件)
6. [設定パラメータ](#設定パラメータ)
7. [リスク管理](#リスク管理)
8. [運用の流れ](#運用の流れ)

---

## 戦略概要

ミーンリバージョン戦略は、価格が短期的に「行き過ぎた」状態を検出し、平均価格への回帰を狙う逆張り戦略です。

### 基本的な考え方

```
価格が上がりすぎ → いずれ下がる → ショート
価格が下がりすぎ → いずれ上がる → ロング
```

### 対象通貨ペア

| 通貨 | シンボル形式 |
|------|-------------|
| ビットコイン | BTC, BTC/USDC, BTC-PERP, BTCUSDC |
| イーサリアム | ETH, ETH/USDC, ETH-PERP, ETHUSDC |
| リップル | XRP, XRP/USDC, XRP-PERP, XRPUSDC |

---

## なぜミーンリバージョンか

$100の小資金で運用する場合、以下の理由でミーンリバージョン戦略が最適です。

### 他の戦略との比較

| 戦略 | 勝率 | 小資金適性 | 問題点 |
|------|------|------------|--------|
| モメンタム・スキャルピング | 45-55% | △ | 手数料負けしやすい |
| グリッドトレーディング | 60-70% | ✗ | 資金分散が困難 |
| ファンディングレート | - | ✗ | ヘッジコストが高い |
| ブレイクアウト | 35-45% | ○ | 低勝率で精神的負担 |
| **ミーンリバージョン** | **55-65%** | **◎** | - |

### 選定理由

1. **高勝率（55-65%）**
   - 小資金では連敗が致命的
   - 高勝率で資金と精神の安定を確保

2. **明確なシグナル**
   - RSIとボリンジャーバンドの極値は客観的
   - 裁量の入る余地が少ない

3. **短いホールド時間**
   - 30分以内に決済
   - ファンディングコスト（8時間ごと）を回避

4. **適度な取引頻度**
   - 1日3-10回程度
   - 手数料負担と収益機会のバランスが良い

---

## 使用するテクニカル指標

### RSI（相対力指数）

価格の「買われすぎ」「売られすぎ」を0-100の数値で表します。

```
RSI = 100 - (100 / (1 + RS))
RS = 平均上昇幅 / 平均下落幅
```

| 範囲 | 意味 |
|------|------|
| 0-25 | 売られすぎ（買いシグナル） |
| 25-75 | 中立 |
| 75-100 | 買われすぎ（売りシグナル） |

**本戦略での設定値:**
- 期間: 14
- 売られすぎ閾値: 25（通常の30より厳格）
- 買われすぎ閾値: 75（通常の70より厳格）

### ボリンジャーバンド

価格の標準偏差を使って「異常な価格帯」を検出します。

```
中央線（SMA） = 過去N期間の単純移動平均
上バンド = SMA + (標準偏差 × K)
下バンド = SMA - (標準偏差 × K)
```

**本戦略での設定値:**
- 期間: 20
- 標準偏差倍率: 2.5（通常の2より厳格）

### なぜ厳格な設定か

通常より厳しい閾値を使う理由:

1. **シグナルの質を向上** - 本当に極端な状況でのみエントリー
2. **取引回数を抑制** - 手数料負担を軽減
3. **勝率向上** - 明確な反発ポイントを狙う

---

## エントリー条件

### ロングエントリー（買い）

両方の条件を同時に満たした場合にロングポジションを取ります。

```
RSI < 25（売られすぎ）
AND
現在価格 < ボリンジャーバンド下限
```

**イメージ:**
```
                    ━━━ 上バンド
        ───────────────── SMA（中央線）
                    ━━━ 下バンド
   ●←ここでロング
   価格が下バンドを下抜け + RSI < 25
```

### ショートエントリー（売り）

両方の条件を同時に満たした場合にショートポジションを取ります。

```
RSI > 75（買われすぎ）
AND
現在価格 > ボリンジャーバンド上限
```

**イメージ:**
```
   ●←ここでショート
   価格が上バンドを上抜け + RSI > 75
                    ━━━ 上バンド
        ───────────────── SMA（中央線）
                    ━━━ 下バンド
```

---

## エグジット条件

ポジションを持った後、以下のいずれかの条件で決済します。

### 1. 利確（Take Profit）

**ロングの場合:**
```
現在価格 >= エントリー価格 × 1.004（+0.4%）
```

**ショートの場合:**
```
現在価格 <= エントリー価格 × 0.996（-0.4%）
```

### 2. 損切り（Stop Loss）

**ロングの場合:**
```
現在価格 <= エントリー価格 × 0.9975（-0.25%）
```

**ショートの場合:**
```
現在価格 >= エントリー価格 × 1.0025（+0.25%）
```

### 3. タイムアウト

```
ポジション保有時間 > 30分
```

利確にも損切りにも達しない場合、30分で強制決済します。

### エグジットフロー図

```
┌─────────────────────────────────────────┐
│           ポジション保有中              │
└────────────────┬────────────────────────┘
                 │
                 ▼
        ┌────────────────┐
        │  価格チェック  │
        └────────┬───────┘
                 │
    ┌────────────┼────────────┐
    │            │            │
    ▼            ▼            ▼
┌────────┐  ┌────────┐  ┌────────┐
│TP到達？│  │SL到達？│  │30分経過│
└───┬────┘  └───┬────┘  └───┬────┘
    │Yes        │Yes        │Yes
    ▼           ▼           ▼
┌────────────────────────────────────┐
│            ポジション決済            │
└────────────────────────────────────┘
```

---

## 設定パラメータ

### パラメータ一覧

| パラメータ | キー | デフォルト | 説明 |
|------------|------|------------|------|
| RSI期間 | `rsi_period` | 14 | RSI計算に使う期間 |
| RSI売られすぎ | `rsi_oversold` | 25.0 | ロングエントリー閾値 |
| RSI買われすぎ | `rsi_overbought` | 75.0 | ショートエントリー閾値 |
| BB期間 | `bb_period` | 20 | ボリンジャーバンドSMA期間 |
| BB標準偏差 | `bb_std_dev` | 2.5 | バンド幅の倍率 |
| 利確幅 | `take_profit_pct` | 0.004 | 0.4% |
| 損切り幅 | `stop_loss_pct` | 0.0025 | 0.25% |
| 最大保有時間 | `max_hold_time` | 1800 | 秒（30分） |
| ポジションサイズ | `position_size` | 0.001 | 1取引あたりの数量 |
| 最大ポジション数 | `max_positions` | 1 | 同時保有できるポジション数 |

### 設定例（YAML）

```yaml
strategy:
  name: "mean_reversion"
  config:
    # RSI設定
    rsi_period: 14
    rsi_oversold: 25
    rsi_overbought: 75

    # ボリンジャーバンド設定
    bb_period: 20
    bb_std_dev: 2.5

    # 決済設定
    take_profit_pct: 0.004   # 0.4%
    stop_loss_pct: 0.0025    # 0.25%
    max_hold_time: 1800      # 30分

    # ポジション設定
    position_size: 0.001
    max_positions: 1
```

### パラメータ調整のヒント

| 状況 | 調整方法 |
|------|----------|
| 取引が多すぎる | RSI閾値を厳しく（20/80）、BB倍率を上げる（3.0） |
| 取引が少なすぎる | RSI閾値を緩く（30/70）、BB倍率を下げる（2.0） |
| 損切りが多い | stop_loss_pctを広げる（0.003） |
| 利益が伸びない | take_profit_pctを上げる（0.005） |

---

## リスク管理

### キルスイッチ条件

システムが自動的に取引を停止する条件:

| 条件 | 閾値 | アクション |
|------|------|------------|
| 日次損失 | -5% | 24時間停止 |
| 週次損失 | -15% | 7日間停止 |
| 連続負け | 5回 | 停止＆アラート |
| 最大ドローダウン | -30% | 完全停止 |

### ポジション管理ルール

1. **同時ポジション**: 1つまで
2. **推奨レバレッジ**: 5x（保守的にスタート）
3. **1トレードリスク**: 資金の2.5%以下

### 資金管理の計算例

```
初期資金: $100
レバレッジ: 5x
ポジションサイズ: $500相当

ストップロス: 0.25%
1トレードの最大損失: $500 × 0.25% = $1.25
資金に対する比率: $1.25 / $100 = 1.25%
```

---

## 運用の流れ

### フェーズ1: ペーパートレード（2週間）

```bash
EXCHANGE_TESTNET=true make run
```

- 実際の資金を使わずにロジックを検証
- 勝率・損益を記録
- パラメータを調整

### フェーズ2: マイクロライブ（2週間）

- $10で実際に取引
- 約定状況を確認
- スリッページを測定

### フェーズ3: スモールライブ（4週間）

- $50で運用
- 安定性を検証
- キルスイッチの動作確認

### フェーズ4: フルライブ

- $100で本番運用
- 継続的なモニタリング
- 必要に応じてパラメータ調整

### 日次チェックリスト

- [ ] 前日の損益確認
- [ ] 未決済ポジションの確認
- [ ] エラーログの確認
- [ ] 市場の異常（大きなニュース等）の確認

---

## 期待パフォーマンス

### 理想的なシナリオ

| 項目 | 値 |
|------|-----|
| 1日あたり取引 | 5回 |
| 勝率 | 60% |
| 平均利益 | $4（0.4%） |
| 平均損失 | $2.5（0.25%） |
| 手数料/取引 | $0.90 |
| 期待日次損益 | +$2.50 |
| 月間期待収益 | $75（75% ROI） |

### 現実的な見積もり

上記は理想値です。実際は以下の要因で30-50%減少を想定:

- 勝率の低下
- スリッページ
- 約定遅延
- 市場環境の変化

**保守的な月間期待収益: $30-50（30-50% ROI）**

---

## トラブルシューティング

### よくある問題と対処法

| 問題 | 原因 | 対処法 |
|------|------|--------|
| シグナルが出ない | データ不足 | 20期間以上の価格データを蓄積 |
| 連敗が続く | トレンド相場 | 取引を一時停止、パラメータ調整 |
| 約定しない | 流動性不足 | 取引量の多い時間帯に限定 |
| 想定外の損失 | レバレッジ過大 | レバレッジを下げる |

---

## 参考資料

- [Hyperliquid公式ドキュメント](https://hyperliquid.gitbook.io/)
- [RSI（相対力指数）について](https://www.investopedia.com/terms/r/rsi.asp)
- [ボリンジャーバンドについて](https://www.investopedia.com/terms/b/bollingerbands.asp)
